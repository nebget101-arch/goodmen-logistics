<div class="customers-list">
  <div class="header">
    <h2>Customers</h2>
    <div class="header-buttons">
      <button class="btn btn-secondary" (click)="goToBulkUpload()">ðŸ“Š Bulk Upload</button>
      <button class="btn btn-primary" (click)="goToNew()">+ New Customer</button>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div class="filters">
    <input class="form-control" placeholder="Search company, phone, email" [(ngModel)]="filters.search" (input)="loadCustomers()" />

    <select class="form-control" [(ngModel)]="filters.type" (change)="loadCustomers()">
      <option value="">All Types</option>
      <option *ngFor="let t of customerTypes" [value]="t">{{ t }}</option>
    </select>

    <select class="form-control" [(ngModel)]="filters.status" (change)="loadCustomers()">
      <option value="">All Statuses</option>
      <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
    </select>

    <select class="form-control" [(ngModel)]="filters.paymentTerms" (change)="loadCustomers()">
      <option value="">All Payment Terms</option>
      <option *ngFor="let p of paymentTerms" [value]="p">{{ p }}</option>
    </select>

    <select class="form-control" [(ngModel)]="filters.locationId" (change)="loadCustomers()">
      <option value="">All Locations</option>
      <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
    </select>

    <button class="btn btn-secondary" (click)="clearFilters()">Clear</button>
  </div>

  <div *ngIf="loading" class="alert alert-info">Loading...</div>

  <div class="table-responsive" *ngIf="!loading">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Company</th>
          <th>Type</th>
          <th>Status</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Default Location</th>
          <th>Last Service Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of customers">
          <td>{{ c.company_name }}</td>
          <td>{{ c.customer_type }}</td>
          <td>
            <span class="badge" [ngClass]="c.status === 'ACTIVE' ? 'badge-success' : 'badge-secondary'">
              {{ c.status }}
            </span>
          </td>
          <td>{{ c.phone }}</td>
          <td>{{ c.email }}</td>
          <td>{{ c.default_location_id || 'â€”' }}</td>
          <td>{{ c.last_service_date ? (c.last_service_date | date:'shortDate') : 'â€”' }}</td>
          <td>
            <button class="btn btn-sm btn-info" (click)="viewCustomer(c.id)">View</button>
            <button class="btn btn-sm btn-primary" (click)="editCustomer(c.id)">Edit</button>
            <button class="btn btn-sm btn-warning" (click)="toggleStatus(c)">
              {{ c.status === 'ACTIVE' ? 'Deactivate' : 'Activate' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="pagination-controls">
      <div class="pagination-info">
        <p>Showing {{ (page - 1) * pageSize + 1 }} to {{ Math.min(page * pageSize, total) }} of {{ total }} customers</p>
      </div>
      <nav aria-label="Page navigation">
        <ul class="pagination">
          <li class="page-item" [ngClass]="{ disabled: page === 1 }">
            <button class="page-link" (click)="previousPage()" [disabled]="page === 1">Previous</button>
          </li>
          
          <li class="page-item" *ngFor="let p of getPageNumbers()" [ngClass]="{ active: p === page }">
            <button class="page-link" (click)="goToPage(p)" [disabled]="p === page">{{ p }}</button>
          </li>
          
          <li class="page-item" [ngClass]="{ disabled: page >= totalPages }">
            <button class="page-link" (click)="nextPage()" [disabled]="page >= totalPages">Next</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
