<div class="app-shell">
  <aside class="sidebar" *ngIf="isLoggedIn()">
    <div class="sidebar-header">
      <img src="assets/goodmen-logo-simple.svg" alt="Goodmen Logistics Logo">
      <div class="brand">
        <div class="brand-title">GOODMEN</div>
        <div class="brand-subtitle">Logistics</div>
      </div>
    </div>
    <nav class="sidebar-nav">
      <ul class="nav-links">
        <li *ngIf="canSee('dashboard')"><a routerLink="/dashboard" routerLinkActive="active"><span class="nav-icon">ğŸ“Š</span>Dashboard</a></li>
        <li *ngIf="canSee('loads')"><a routerLink="/loads" routerLinkActive="active"><span class="nav-icon">ğŸ“¦</span>Loads</a></li>
        <li *ngIf="canSee('drivers')"><a routerLink="/drivers" routerLinkActive="active"><span class="nav-icon">ğŸ‘¤</span>Drivers</a></li>
        <li class="nav-section" *ngIf="canSee('vehicles')">
          <button class="section-toggle" (click)="toggleEquipment()" type="button" [attr.aria-expanded]="equipmentExpanded">
            <span class="section-icon">ğŸš›</span>
            <span class="section-label">Equipment</span>
            <span class="toggle-chevron" [class.rotated]="equipmentExpanded">â–¶</span>
          </button>
        </li>
        <li *ngIf="canSee('vehicles') && equipmentExpanded" class="nav-subsection"><a routerLink="/vehicles" routerLinkActive="active">Trucks</a></li>
        <li *ngIf="canSee('vehicles') && equipmentExpanded" class="nav-subsection"><a routerLink="/trailers" routerLinkActive="active">Trailers</a></li>
        <li *ngIf="canSee('hos') || canSee('audit')" class="nav-section">
          <button class="section-toggle" (click)="toggleSafety()" type="button" [attr.aria-expanded]="safetyExpanded">
            <span class="section-icon">ğŸ›¡ï¸</span>
            <span class="section-label">Safety</span>
            <span class="toggle-chevron" [class.rotated]="safetyExpanded">â–¶</span>
          </button>
        </li>
        <li *ngIf="canSee('hos') && safetyExpanded" class="nav-subsection"><a routerLink="/hos" routerLinkActive="active">HOS</a></li>
        <li *ngIf="canSee('audit') && safetyExpanded" class="nav-subsection"><a routerLink="/audit" routerLinkActive="active">Audit</a></li>
        <li *ngIf="canSee('maintenance') || canSee('parts') || canSee('customers')" class="nav-section">
          <button class="section-toggle" (click)="toggleFleet()" type="button" [attr.aria-expanded]="fleetExpanded">
            <span class="section-icon">ğŸšš</span>
            <span class="section-label">Fleet</span>
            <span class="toggle-chevron" [class.rotated]="fleetExpanded">â–¶</span>
          </button>
        </li>
        <li *ngIf="canSee('maintenance') && fleetExpanded" class="nav-subsection"><a routerLink="/maintenance" routerLinkActive="active">Maintenance</a></li>
        <li *ngIf="canSee('parts') && fleetExpanded" class="nav-subsection"><a routerLink="/parts" routerLinkActive="active">Parts</a></li>
        <li *ngIf="canSee('customers') && fleetExpanded" class="nav-subsection"><a routerLink="/customers" routerLinkActive="active">Customers</a></li>
        <li *ngIf="canSee('invoices')" class="nav-section">
          <button class="section-toggle" (click)="toggleAccounting()" type="button" [attr.aria-expanded]="accountingExpanded">
            <span class="section-icon">ğŸ’°</span>
            <span class="section-label">Accounting</span>
            <span class="toggle-chevron" [class.rotated]="accountingExpanded">â–¶</span>
          </button>
        </li>
        <li *ngIf="canSee('invoices') && accountingExpanded" class="nav-subsection"><a routerLink="/invoices" routerLinkActive="active">Invoices</a></li>
        <li *ngIf="userRole === 'admin'"><a routerLink="/users/create" routerLinkActive="active"><span class="nav-icon">â•</span>Add User</a></li>
      </ul>
    </nav>
    <div class="sidebar-actions">
      <button (click)="logout()" class="btn btn-ghost">Logout</button>
    </div>
  </aside>

  <main class="content">
    <div class="topbar" *ngIf="!isLoggedIn()">
      <div class="topbar-brand">
        <img src="assets/goodmen-logo-simple.svg" alt="Goodmen Logistics Logo">
        <div>
          <div class="brand-title">GOODMEN</div>
          <div class="brand-subtitle">Logistics</div>
        </div>
      </div>
      <button routerLink="/login" class="btn btn-primary">Login</button>
    </div>
    <router-outlet></router-outlet>
  </main>
</div>
